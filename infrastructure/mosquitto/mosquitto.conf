# Eclipse Mosquitto MQTT Broker Configuration
# WebSCADA Production - IEC 62443 Compliant
# Supports: GSM ESP32, LoRaWAN, Standard MQTT

# ============================================
# GENERAL
# ============================================
user mosquitto
max_queued_messages 1000
max_packet_size 10485760
allow_duplicate_messages false

# ============================================
# PERSISTENCE
# ============================================
persistence true
persistence_location /mosquitto/data/
autosave_interval 300
autosave_on_changes false

# ============================================
# LOGGING
# ============================================
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ============================================
# LISTENERS - MQTT (Non-TLS)
# ============================================
listener 1883
protocol mqtt
max_connections -1
allow_anonymous true

# ============================================
# LISTENERS - MQTT over TLS (commented out - configure when ready)
# ============================================
# listener 8883
# protocol mqtt
# cafile /mosquitto/certs/ca.crt
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key
# require_certificate false
# use_identity_as_username false
# tls_version tlsv1.2

# ============================================
# LISTENERS - WebSocket
# ============================================
listener 9001
protocol websockets
allow_anonymous true

# ============================================
# SECURITY (commented out - configure password file when ready)
# ============================================
# password_file /mosquitto/config/passwd

# ACL (Access Control List)
# acl_file /mosquitto/config/acl.conf

# ============================================
# PERFORMANCE
# ============================================
max_inflight_messages 20
max_queued_messages 1000
queue_qos0_messages false
set_tcp_nodelay true

# ============================================
# PERSISTENCE TUNING
# ============================================
persistent_client_expiration 1h
