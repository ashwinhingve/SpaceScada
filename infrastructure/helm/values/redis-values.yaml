# Bitnami Redis Helm Chart Values for WebSCADA
# Install with: helm install redis bitnami/redis -f redis-values.yaml -n webscada

## Global configuration
global:
  redis:
    password: ''  # Disable password for simplicity (enable in production)

## Redis architecture
architecture: standalone  # Use 'replication' for HA in production

## Redis configuration
auth:
  enabled: false  # Enable in production
  password: ''
  existingSecret: ''
  existingSecretPasswordKey: ''

## Master configuration
master:
  ## Resource limits - minimal footprint for caching
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m

  ## Persistence configuration
  persistence:
    enabled: true
    storageClass: ''  # Use default storage class
    size: 5Gi
    accessModes:
      - ReadWriteOnce

  ## Redis configuration for caching workload
  configuration: |
    # Memory management
    maxmemory 200mb
    maxmemory-policy allkeys-lru

    # Persistence
    save 900 1
    save 300 10
    save 60 10000

    # Append-only file
    appendonly yes
    appendfsync everysec

    # Performance tuning
    tcp-backlog 511
    timeout 0
    tcp-keepalive 300

    # Logging
    loglevel notice

    # Slow log
    slowlog-log-slower-than 10000
    slowlog-max-len 128

  ## Service configuration
  service:
    type: ClusterIP
    ports:
      redis: 6379

  ## Liveness and readiness probes
  livenessProbe:
    enabled: true
    initialDelaySeconds: 20
    periodSeconds: 5
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 5

  readinessProbe:
    enabled: true
    initialDelaySeconds: 20
    periodSeconds: 5
    timeoutSeconds: 1
    successThreshold: 1
    failureThreshold: 5

  ## Pod affinity
  podAntiAffinityPreset: soft

## Replica configuration (if using replication)
replica:
  replicaCount: 0  # Set to 2+ for HA in production

  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m

## Metrics configuration
metrics:
  enabled: true

  resources:
    requests:
      memory: 32Mi
      cpu: 25m
    limits:
      memory: 64Mi
      cpu: 50m

  serviceMonitor:
    enabled: true
    namespace: webscada
    interval: 30s
    scrapeTimeout: 10s

## Volume permissions
volumePermissions:
  enabled: false

## Network Policy
networkPolicy:
  enabled: false
  # Enable in production with specific policies

## Pod Security Policy
podSecurityPolicy:
  create: false

## Service Account
serviceAccount:
  create: true
  name: redis
  automountServiceAccountToken: false
